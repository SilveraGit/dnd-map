<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DND Map</title>
    <style>
        body {
            background-color: #f0f0f0;
            font-family: Arial, sans-serif;
        }
        #mapContainer {
            width: 1024px;
            height: 1024px;
            background-color: #d3d3d3; /* Gray background */
            overflow: auto;
            margin: 20px auto;
            text-align: center;
            position: relative;
            border: 1px solid #000;
        }
        .token {
            width: 40px;
            height: 40px;
            background-color: red; /* Default token color */
            border-radius: 50%; /* Round shape */
            position: absolute;
            cursor: pointer;
            transition: top 0.1s, left 0.1s; /* Smooth movement */
        }
        .token img {
            width: 100%;
            height: 100%;
            border-radius: 50%; /* Ensures image is round */
        }
        .controls {
            margin: 20px auto;
            text-align: center;
        }
        .controls button {
            padding: 10px 20px;
            margin: 5px;
            font-size: 16px;
        }
    </style>
</head>
<body>
<h1>Select an image for the map</h1>

<!-- File input to select an image -->
<input type="file" id="fileInput" accept="image/*" />

<!-- Container for displaying the selected map image -->
<div id="mapContainer">
    <img id="mapImage" src="map_default.jpg" alt="Map Image" />

    <!-- Tokens -->
    <div class="token" id="token1" style="top: 100px; left: 100px;">
        <img src="player1.png" alt="Token 1" />
    </div>
    <div class="token" id="token2" style="top: 200px; left: 200px;">
        <img src="player2.png" alt="Token 2" />
    </div>
    <div class="token" id="token3" style="top: 300px; left: 300px;">
        <img src="player3.png" alt="Token 3" />
    </div>
    <div class="token" id="token4" style="top: 400px; left: 400px;">
        <img src="player4.png" alt="Token 4" />
    </div>
</div>

<!-- Controls to move tokens -->
<div class="controls">
    <button onclick="moveToken('token1', 10, 0)">Move Token 1 Right</button>
    <button onclick="moveToken('token2', -10, 0)">Move Token 2 Left</button>
    <button onclick="moveToken('token3', 0, 10)">Move Token 3 Down</button>
    <button onclick="moveToken('token4', 0, -10)">Move Token 4 Up</button>
</div>

<script>
        let selectedToken = null;
        let offsetX = 0;
        let offsetY = 0;

        // Function to start dragging the token
        function onTouchStart(event, tokenId) {
            const token = document.getElementById(tokenId);
            selectedToken = token;

            // Get touch position
            const touch = event.touches[0];
            const tokenRect = token.getBoundingClientRect();

            // Store the offset of the touch from the token's top-left corner
            offsetX = touch.pageX - tokenRect.left;
            offsetY = touch.pageY - tokenRect.top;

            // Prevent default touch behavior
            event.preventDefault();
        }

        // Function to move the token based on touch move
        function onTouchMove(event) {
            if (selectedToken) {
                const touch = event.touches[0];
                const newX = touch.pageX - offsetX;
                const newY = touch.pageY - offsetY;

                // Update token position
                selectedToken.style.left = newX + 'px';
                selectedToken.style.top = newY + 'px';
            }

            event.preventDefault();
        }

        // Function to stop dragging
        function onTouchEnd() {
            selectedToken = null;
        }

        // Attach touch event listeners to each token
        document.querySelectorAll('.token').forEach(token => {
            token.addEventListener('touchstart', (event) => onTouchStart(event, token.id));
            token.addEventListener('touchmove', onTouchMove);
            token.addEventListener('touchend', onTouchEnd);
            token.addEventListener('touchcancel', onTouchEnd);
        });

        // Function to move a token via button controls
        function moveToken(tokenId, xOffset, yOffset) {
            const token = document.getElementById(tokenId);
            const rect = token.getBoundingClientRect();
            token.style.left = rect.left + xOffset + 'px';
            token.style.top = rect.top + yOffset + 'px';
        }

        // Function to display the selected image for the map
        document.getElementById("fileInput").addEventListener("change", function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById("mapImage").src = e.target.result;
                };
                reader.readAsDataURL(file);
            }
        });
    </script>
</body>
</html>